<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Tetris</title>
        <style>
        #arena{}
        </style>
    </head>
    <body>
        <canvas id="arena">
            <script>
            var arena = document.getElementById('arena');
            arena.width = 100, arena.height = 240;
            var ctx = arena.getContext('2d');
            var last = 0;
            
            var buffer = (new Array(24)).map(function(col){ 
                return (new Array(10)).fill(0)
            });
            var fall = [];

            function test(t) {
                fall.push({x:0, y:0});
            }

            function logic(timestamp) {
                if (timestamp - last < 1000) {
                    return;
                }
                last = timestamp;
                var able = fall.reduce(function(a, dot){
                    return a && dot.y < 23 && buffer[dot.y + 1][dot.x] == 0
                }, true);
                if (able) {
                    fall.map(function(dot){
                        buffer[dot.y][dot.x] = 0;
                        dot.y += 1;
                        console.log(dot.y, dot.x)
                        buffer[dot.y][dot.x] = 1;
                    })
                }
            }
            
            function update(timestamp) {
                ctx.fillStyle = '#ccc';
                ctx.fillRect(0, 0, arena.width, arena.height);
                logic(timestamp);
                buffer.map(function(row, y) {
                    row.map(function(t, x){
                        ctx.fillStyle = t == 0 ? '#fff' : '#000';
                        ctx.fillRect(x*10, y*10, 9, 9);
                    });
                });
                requestAnimationFrame(update);
            }

            update();
            </script>
        </canvas>
    </body>
</html>